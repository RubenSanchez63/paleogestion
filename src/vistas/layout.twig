<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <title>PaleoGestión - Museo de Dinosaurios</title>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        fossil: {
                            50: '#faf8f5',
                            100: '#f0ebe3',
                            200: '#e0d5c6',
                            300: '#c9b8a0',
                            400: '#b19a7a',
                            500: '#9a7f5f',
                            600: '#8a6d4f',
                            700: '#735a42',
                            800: '#5f4a38',
                            900: '#4e3d2f',
                            950: '#2a2018'
                        },
                        dino: {
                            50: '#f4f7f4',
                            100: '#e3eae3',
                            200: '#c8d5c8',
                            300: '#a3b8a3',
                            400: '#7a957a',
                            500: '#5b775b',
                            600: '#475f47',
                            700: '#3a4d3a',
                            800: '#313f31',
                            900: '#29352a',
                            950: '#141c15'
                        }
                    },
                    fontFamily: {
                        'display': ['Cinzel', 'serif'],
                        'body': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, #1a1612 0%, #2a2018 50%, #1a1612 100%);
            min-height: 100vh;
        }
        .hero-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239a7f5f' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .glass-card {
            background: rgba(42, 32, 24, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(154, 127, 95, 0.2);
        }
        .dino-shadow {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5), 
                        0 0 0 1px rgba(154, 127, 95, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        .bone-texture {
            background: linear-gradient(135deg, #f0ebe3 0%, #e0d5c6 50%, #c9b8a0 100%);
        }
        .table-row-hover:hover {
            background: rgba(154, 127, 95, 0.1);
            transform: translateX(4px);
            transition: all 0.3s ease;
        }
        .btn-fossil {
            background: linear-gradient(135deg, #9a7f5f 0%, #735a42 100%);
            transition: all 0.3s ease;
        }
        .btn-fossil:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(154, 127, 95, 0.3);
        }
        .dropdown-glass {
            background: rgba(42, 32, 24, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(154, 127, 95, 0.3);
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .float-animation {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        .fossil-input {
            background: rgba(26, 22, 18, 0.8);
            border: 1px solid rgba(154, 127, 95, 0.3);
            color: #f0ebe3;
            transition: all 0.3s ease;
        }
        .fossil-input:focus {
            border-color: #9a7f5f;
            box-shadow: 0 0 0 3px rgba(154, 127, 95, 0.2);
            outline: none;
        }
        .fossil-input::placeholder {
            color: rgba(154, 127, 95, 0.5);
        }
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 500;
        }
        .truncate{

        }
        .status-estudio { background: rgba(59, 130, 246, 0.2); color: #93c5fd; border: 1px solid rgba(59, 130, 246, 0.3); }
        .status-exposicion { background: rgba(34, 197, 94, 0.2); color: #86efac; border: 1px solid rgba(34, 197, 94, 0.3); }
        .status-almacen { background: rgba(251, 191, 36, 0.2); color: #fcd34d; border: 1px solid rgba(251, 191, 36, 0.3); }
    </style>
</head>
<body class="hero-pattern text-fossil-100">
    <!-- Dinosaur silhouette decorations -->
    <div class="fixed top-20 left-10 opacity-5 pointer-events-none">
        <svg class="w-64 h-64 float-animation" viewBox="0 0 100 100" fill="currentColor">
            <path d="M85 45c0-5-3-9-7-11 1-2 2-5 2-8 0-8-6-14-14-14-2 0-4 0-6 1-3-4-8-7-14-7-10 0-18 8-18 18 0 2 0 4 1 6-6 2-10 8-10 15 0 9 7 16 16 16h46c8 0 14-7 14-16z"/>
            <ellipse cx="50" cy="85" rx="35" ry="5" opacity="0.3"/>
        </svg>
    </div>
    <div class="fixed bottom-20 right-10 opacity-5 pointer-events-none">
        <svg class="w-48 h-48 float-animation" style="animation-delay: -3s;" viewBox="0 0 100 60" fill="currentColor">
            <path d="M95 30c-5-15-25-20-40-18-10-8-25-8-35 0-8 5-15 15-10 28 3 8 12 15 25 15h50c10 0 15-15 10-25z"/>
        </svg>
    </div>

    <!-- Navigation -->
    <nav class="glass-card sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <a href="/" class="flex items-center gap-4 group">
                    <div class="relative">
                        <!-- Make logo image fill container completely -->
                        <div class="w-14 h-14 rounded-full bg-gradient-to-br from-fossil-400 to-fossil-700 flex items-center justify-center dino-shadow group-hover:scale-110 transition-transform duration-300 overflow-hidden">
                            <img src="/favicon.png" alt="PaleoGestión Logo" class="w-full h-full object-cover" />
                        </div>
                        <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-dino-500 rounded-full border-2 border-fossil-950"></div>
                    </div>
                    <div>
                        <h1 class="font-display text-2xl font-bold text-fossil-100 tracking-wide">PaleoGestión</h1>
                        <p class="text-fossil-400 text-xs tracking-widest uppercase">Sistema de Gestión Paleontológica</p>
                    </div>
                </a>

                <!-- User Menu -->
                <div class="relative">
                    {% if sesionActiva %}
                        <div class="group">
                            <button id="userDropdown" class="flex items-center gap-3 px-4 py-2 rounded-xl bg-fossil-900/50 border border-fossil-700/30 hover:border-fossil-500/50 transition-all duration-300">
                                <div class="w-9 h-9 rounded-full bg-gradient-to-br from-dino-400 to-dino-600 flex items-center justify-center text-white font-semibold text-sm">
                                    {{ usuarioActivo|default('U')|first|upper }}
                                </div>
                                <span class="text-fossil-200 font-medium">{{ usuarioActivo|default('Usuario') }}</span>
                                <svg class="w-4 h-4 text-fossil-400 group-hover:text-fossil-200 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                </svg>
                            </button>
                            <div class="absolute right-0 mt-2 w-48 dropdown-glass rounded-xl shadow-2xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-2">
                                <div class="py-2">
                                    <a onclick="logout(); return false" class="flex items-center gap-3 px-4 py-3 text-fossil-300 hover:text-fossil-100 hover:bg-fossil-800/50 cursor-pointer transition-colors">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l-4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                                        </svg>
                                        Cerrar Sesión
                                    </a>
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <div class="group">
                            <button id="loginDropdown" class="flex items-center gap-2 px-5 py-2.5 rounded-xl btn-fossil text-white font-medium">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                </svg>
                                Iniciar Sesión
                            </button>
                            <div class="absolute right-0 mt-2 w-80 dropdown-glass rounded-2xl shadow-2xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform group-hover:translate-y-0 translate-y-2 p-6">
                                <div class="text-center mb-6">
                                    <div class="w-16 h-16 mx-auto rounded-full bg-gradient-to-br from-fossil-400 to-fossil-600 flex items-center justify-center mb-3">
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                        </svg>
                                    </div>
                                    <h3 class="font-display text-xl text-fossil-100">Bienvenido</h3>
                                    <p class="text-fossil-400 text-sm">Accede a tu cuenta de investigador</p>
                                </div>
                                <form method="POST" id="login" class="space-y-4">
                                    <div>
                                        <label for="usuario" class="block text-fossil-300 text-sm font-medium mb-2">Usuario</label>
                                        <input type="text" id="usuario" name="user" required 
                                            class="w-full px-4 py-3 rounded-xl fossil-input">
                                    </div>
                                    <div>
                                        <label for="password" class="block text-fossil-300 text-sm font-medium mb-2">Contraseña</label>
                                        <input type="password" id="password" name="password" required 
                                            class="w-full px-4 py-3 rounded-xl fossil-input">
                                    </div>
                                    <p class="hidden text-red-400 text-sm text-center py-2 px-3 bg-red-500/10 rounded-lg border border-red-500/20" id="mensaje"></p>
                                    <button type="button" onclick="login()" 
                                        class="w-full py-3 rounded-xl btn-fossil text-white font-semibold">
                                        Acceder al Museo
                                    </button>
                                </form>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="relative overflow-hidden py-12">
        <div class="max-w-7xl mx-auto px-6">
            <div class="text-center mb-8 fade-in">
                <h2 class="font-display text-4xl md:text-5xl font-bold text-fossil-100 mb-4">
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-fossil-300 to-fossil-500">Descubre el Pasado</span>
                </h2>
                <p class="text-fossil-400 text-lg max-w-2xl mx-auto">
                    Explora nuestra colección de fósiles prehistóricos y viaja millones de años atrás en el tiempo
                </p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-6 pb-20">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="glass-card mt-20 py-8">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <div class="flex items-center justify-center gap-3 mb-4">
                <!-- Make footer logo fill container completely -->
                <img src="/favicon.png" alt="PaleoGestión" class="w-6 h-6 object-cover" />
                <span class="font-display text-fossil-300">PaleoGestión</span>
            </div>
            <p class="text-fossil-500 text-sm">© 2025 Museo de Dinosaurios. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script>
        function mostrarFosiles(id) {
            fetch('/?id=' + id)
            .then(response => response.text())
            .then(html => {
                const tabla = document.getElementById('tabla-fosiles' + id);
                const tbody = document.getElementById('fosiles-' + id);
                const chevron = document.getElementById('chevron-' + id);
                if (tabla.classList.contains('hidden')) {
                    tabla.classList.remove('hidden');
                    tbody.innerHTML = html;
                    if(chevron) chevron.style.transform = 'rotate(180deg)';
                } else {
                    tabla.classList.add('hidden');
                    tbody.innerHTML = '';
                    if(chevron) chevron.style.transform = 'rotate(0deg)';
                }
            });
        }

        function formularioEsqueleto() {
            fetch('/?formNuevo=1')
            .then(response => response.text())
            .then(html => {
                borrarFormulario('.esqFormRow');
                document.getElementById('mainBody').innerHTML += html;
            });
        }

        function borrarFormulario(clase) {
            const row = document.querySelector(clase);
            if(row) row.remove();
        }

        function borrarEsqueleto(id) {
            const boton = document.getElementById('borrar' + id);
            if (boton.innerHTML.includes("Confirmar")) {
                boton.setAttribute("href", "?borrar=" + id);
            } else {
                boton.innerHTML = `<svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>Confirmar`;
            }
        }

        function editarEsqueleto(id) {
            fetch('/?formEditar=' + id)
            .then(response => response.text())
            .then(html => {
                const esqRow = document.querySelector('.esqRow' + id);
                esqRow.innerHTML = html;
            });
        }

        function formularioFosil(idEsq) {
            fetch('/?formFosil=' + idEsq)
            .then(response => response.text())
            .then(html => {
                const tabla = document.getElementById('tabla-fosiles' + idEsq);
                if (tabla.classList.contains('hidden')) {
                    mostrarFosiles(idEsq);
                } else {
                    borrarFormulario('.fosFormRow')
                }
                const fosRow = document.getElementById('fosiles-' + idEsq);
                fosRow.insertAdjacentHTML('afterend', html);
            });
        }

        function anadirFosilConId(idEsq) {
            const formulario = document.getElementById('nuevoFosil');
            fetch('/?anadirFosil=' + idEsq, {
                method: 'POST',
                body: new FormData(formulario)
            })
            .then(response => response.text())
            .then(message => {
                console.log(message);
                borrarFormulario('.fosFormRow')
                mostrarFosiles(idEsq);
                mostrarFosiles(idEsq);
            });
        }
        
        function borrarFosil(id, idEsq) {
            const boton = document.getElementById('borrarFosil' + id);
            if (boton.innerHTML.includes("Confirmar")) {
                boton.setAttribute("href", "?borrarFosil=" + id);
                mostrarFosiles(idEsq);

            } else {
                boton.innerHTML = `<svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l-4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>Confirmar`;
            }
        }
        
        function editarFosil(id) {
            fetch('/?formEditarFosil=' + id)
            .then(response => response.text())
            .then(html => {
                const fosRow = document.querySelector('.fosRow' + id);
                fosRow.innerHTML = html;
            });
        }

        function reload() {
            window.location.href = "/";
        }

        function login() {
            const formulario = document.getElementById('login');
            fetch('/?login=1', {
                method: 'POST',
                body: new FormData(formulario)
            })
            .then(response => response.text())
            .then(message => {
                if (message === "false") {
                    const mensaje = document.getElementById('mensaje')
                    mensaje.innerHTML = "Credenciales incorrectas. Verifica tu usuario y contraseña.";
                    mensaje.classList.remove('hidden');
                } else {
                    reload();
                }
            });
        }

        function logout() {
            fetch('/?logout=1')
            .then(response => response.text())
            .then(() => {
                reload();
            })
            .catch(error => {
                console.error('Error en logout:', error);
                reload();
            });
        }
    </script>
</body>
</html>

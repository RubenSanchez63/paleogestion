<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <title>PaleoGestión</title>
</head>
<body>
    <div class="container text-center mt-4">
        <h1>PaleoGestión</h1>
        <div class="mt-3">
            {% block content %}{% endblock %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    
    <script>
        function mostrarFosiles(id) {
            fetch('http://localhost:8080?id=' + id)
            .then(response => response.text())
            .then(html => {
                const tabla = document.getElementById('tabla-fosiles' + id);
                const tbody = document.getElementById('fosiles-' + id);
                if (tabla.classList.contains('d-none')) {
                    tabla.classList.remove('d-none');
                    tbody.innerHTML = html;
                } else {
                    tabla.classList.add('d-none');
                    tbody.innerHTML = '';
                }
            });
        }

        function formularioEsqueleto() {
            fetch('http://localhost:8080?formNuevo=1')
            .then(response => response.text())
            .then(html => {
                borrarFormulario('.esqFormRow');
                document.getElementById('mainBody').innerHTML += html;
            });
        }

        function borrarFormulario(clase) {
            const row = document.querySelector(clase);
            if(row) row.remove();
        }

        function borrarEsqueleto(id) {
            const boton = document.getElementById('borrar' + id);
            if (boton.innerHTML === "Estás seguro?") {
                boton.setAttribute("href", "?borrar=" + id);
            } else {
                boton.innerHTML = "Estás seguro?";
            }
        }

        function editarEsqueleto(id) {
            fetch('http://localhost:8080?formEditar=' + id)
            .then(response => response.text())
            .then(html => {
                const esqRow = document.querySelector('.esqRow' + id);
                esqRow.innerHTML = html;
            });
        }

        function formularioFosil(idEsq) {
            fetch('http://localhost:8080?formFosil=' + idEsq)
            .then(response => response.text())
            .then(html => {
                const tabla = document.getElementById('tabla-fosiles' + idEsq);
                if (tabla.classList.contains('d-none')) {
                    mostrarFosiles(idEsq);
                } else {
                    borrarFormulario('.fosFormRow')
                }
                const fosRow = document.getElementById('fosiles-' + idEsq);
                fosRow.insertAdjacentHTML('afterend', html);
            });
        }

        function anadirFosilConId(idEsq) {
            const formulario = document.getElementById('nuevoFosil');
            fetch('http://localhost:8080?anadirFosil=' + idEsq, {
                method: 'POST',
                body: new FormData(formulario)
            })
            .then(response => response.text())
            .then(message => {
                console.log(message);
                borrarFormulario('.fosFormRow')
                mostrarFosiles(idEsq);
                mostrarFosiles(idEsq);
            });
        }
        
        function borrarFosil(id, idEsq) {
            const boton = document.getElementById('borrarFosil' + id);
            if (boton.innerHTML === "Estás seguro?") {
                boton.setAttribute("href", "?borrarFosil=" + id);
                mostrarFosiles(idEsq);

            } else {
                boton.innerHTML = "Estás seguro?";
            }
        }
        
        function editarFosil(id) {
            fetch('http://localhost:8080?formEditarFosil=' + id)
            .then(response => response.text())
            .then(html => {
                const fosRow = document.querySelector('.fosRow' + id);
                fosRow.innerHTML = html;
            });
        }

        function reload(){
            location.reload();
        }

    </script>
    
</body>
</html>